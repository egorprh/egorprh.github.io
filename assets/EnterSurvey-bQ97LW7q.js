import{a as V,b as $,c as C,r as p,j as r,L as O}from"./index-lQ5WhlC4.js";import{B as D}from"./BackIcon-BS5GjOSZ.js";/* empty css                         *//* empty css                     */import{A as B}from"./Alert-BwKXxjNl.js";function F({user:u}){var x,j,b;const g=V(),{data:t}=$(),{setSurveyPassed:w}=C(),[c,I]=p.useState({}),[m,y]=p.useState({}),[N,h]=p.useState(!1),[k,o]=p.useState(!1),z=(u==null?void 0:u.id)||1,E=(x=t==null?void 0:t.enter_survey)==null?void 0:x.id,v=(e,s)=>{let a=s;(e.type==="phone"||e.type==="age")&&(a=s.replace(/\D/g,"")),I(i=>({...i,[e.id]:a})),y(i=>({...i,[e.id]:!1}))},_=()=>{var a;const e={};let s=null;return(a=t==null?void 0:t.enter_survey)==null||a.questions.forEach(i=>{const l=c[i.id];l?i.type==="age"&&!/^\d{1,3}$/.test(l)&&(e[i.id]="Введите корректный возраст",s||(s=i.id)):(e[i.id]="Это поле обязательно",s||(s=i.id))}),y(e),{isValid:Object.keys(e).length===0,firstInvalidQuestionId:s}},A=e=>{var l;e.preventDefault();const{isValid:s,firstInvalidQuestionId:a}=_();if(!s){const d=`[name="q-${a}"]`,n=document.querySelector(d);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>n.focus(),300));return}h(!0);const i=(l=t==null?void 0:t.enter_survey)==null?void 0:l.questions.reduce((d,n)=>{const f=c[n.id];if(n.type==="quiz"){const S=n.options.find(T=>T.id===f);S&&d.push({questionId:n.id,answerId:S.id,text:""})}else(n.type==="phone"||n.type==="text")&&f&&d.push({questionId:n.id,answerId:0,text:f});return d},[]);fetch("/api/submit_enter_survey",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:z,surveyId:E,answers:i})}).then(d=>{d.ok?(w(!0),g("/")):(o(!0),setTimeout(()=>o(!1),1e3),h(!1))}).catch(()=>{o(!0),setTimeout(()=>o(!1),1e3),h(!1)})};return r.jsxs("div",{className:"survey content quiz-results-content",children:[k&&r.jsx(B,{text:"Произошла ошибка, попробуйте еще раз"}),r.jsxs(O,{to:"/",className:"back-link",children:[r.jsx(D,{}),"Назад"]}),r.jsxs("form",{className:"quiz",onSubmit:A,noValidate:!0,children:[r.jsxs("div",{children:[r.jsx("h1",{children:"Входное тестирование"}),((j=t==null?void 0:t.enter_survey)==null?void 0:j.description)&&r.jsx("p",{className:"survey-description",children:t.enter_survey.description})]}),(b=t==null?void 0:t.enter_survey)==null?void 0:b.questions.map(e=>r.jsxs("div",{className:`quiz-question ${m[e.id]?"error":""}`,children:[r.jsxs("h2",{children:[e.id,". ",e.question]}),m[e.id]&&r.jsx("div",{className:"error-text",children:m[e.id]}),r.jsx("div",{className:"quiz-answers",children:e.type==="quiz"&&e.options.map(s=>r.jsxs("label",{className:"quiz-answer",children:[r.jsx("input",{type:"radio",name:`q-${e.id}`,value:s.id,checked:c[e.id]===s.id,onChange:()=>v(e,s.id)}),s.text]},s.id))}),(e.type==="phone"||e.type==="text")&&r.jsx("input",{className:"quiz-input",type:"text",name:`q-${e.id}`,placeholder:e.type==="phone"?"Введите номер телефона":"Введите ваш ответ",value:c[e.id]||"",onChange:s=>v(e,s.target.value)})]},e.id)),r.jsx("button",{className:"btn",type:"submit",disabled:N,children:"Отправить"})]})]})}export{F as default};
