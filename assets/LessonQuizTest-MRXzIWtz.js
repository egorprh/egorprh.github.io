import{r as l,d as $,a as G,b as U,j as n}from"./index-lQ5WhlC4.js";/* empty css                         */import{A as F}from"./Alert-BwKXxjNl.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var N=function(t,e){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var a in r)r.hasOwnProperty(a)&&(s[a]=r[a])},N(t,e)};function J(t,e){N(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}var Y=100,K=100,I=50,j=50,R=50;function O(t){var e=t.className,s=t.counterClockwise,r=t.dashRatio,a=t.pathRadius,i=t.strokeWidth,d=t.style;return l.createElement("path",{className:e,style:Object.assign({},d,tt({pathRadius:a,dashRatio:r,counterClockwise:s})),d:Z({pathRadius:a,counterClockwise:s}),strokeWidth:i,fillOpacity:0})}function Z(t){var e=t.pathRadius,s=t.counterClockwise,r=e,a=s?1:0;return`
      M `+j+","+R+`
      m 0,-`+r+`
      a `+r+","+r+" "+a+" 1 1 0,"+2*r+`
      a `+r+","+r+" "+a+" 1 1 0,-"+2*r+`
    `}function tt(t){var e=t.counterClockwise,s=t.dashRatio,r=t.pathRadius,a=Math.PI*2*r,i=(1-s)*a;return{strokeDasharray:a+"px "+a+"px",strokeDashoffset:(e?-i:i)+"px"}}var et=function(t){J(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},e.prototype.getPathRadius=function(){return I-this.props.strokeWidth/2-this.getBackgroundPadding()},e.prototype.getPathRatio=function(){var s=this.props,r=s.value,a=s.minValue,i=s.maxValue,d=Math.min(Math.max(r,a),i);return(d-a)/(i-a)},e.prototype.render=function(){var s=this.props,r=s.circleRatio,a=s.className,i=s.classes,d=s.counterClockwise,f=s.styles,g=s.strokeWidth,u=s.text,m=this.getPathRadius(),h=this.getPathRatio();return l.createElement("svg",{className:i.root+" "+a,style:f.root,viewBox:"0 0 "+Y+" "+K,"data-test-id":"CircularProgressbar"},this.props.background?l.createElement("circle",{className:i.background,style:f.background,cx:j,cy:R,r:I}):null,l.createElement(O,{className:i.trail,counterClockwise:d,dashRatio:r,pathRadius:m,strokeWidth:g,style:f.trail}),l.createElement(O,{className:i.path,counterClockwise:d,dashRatio:h*r,pathRadius:m,strokeWidth:g,style:f.path}),u?l.createElement("text",{className:i.text,style:f.text,x:j,y:R},u):null)},e.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},e}(l.Component);function st(t){var e=t.rotation,s=t.strokeLinecap,r=t.textColor,a=t.textSize,i=t.pathColor,d=t.pathTransition,f=t.pathTransitionDuration,g=t.trailColor,u=t.backgroundColor,m=e==null?void 0:"rotate("+e+"turn)",h=e==null?void 0:"center center";return{root:{},path:w({stroke:i,strokeLinecap:s,transform:m,transformOrigin:h,transition:d,transitionDuration:f==null?void 0:f+"s"}),trail:w({stroke:g,strokeLinecap:s,transform:m,transformOrigin:h}),text:w({fill:r,fontSize:a}),background:w({fill:u})}}function w(t){return Object.keys(t).forEach(function(e){t[e]==null&&delete t[e]}),t}function ot({user:t}){const{courseId:e,lessonId:s}=$(),r=G(),{data:a,loading:i,error:d,setData:f,setLoading:g}=U(),[u,m]=l.useState(null),[h,W]=l.useState(0),[k,S]=l.useState(null),[v,E]=l.useState(!1),[C,T]=l.useState(0),[V,A]=l.useState(!1),[P,D]=l.useState(!1),[B,q]=l.useState(!1),[L,H]=l.useState([]);l.useEffect(()=>{var o,c,x;if(!i&&a){const p=(o=a.courses)==null?void 0:o.find(b=>String(b.id)===e),y=(c=p==null?void 0:p.lessons)==null?void 0:c.find(b=>String(b.id)===s);(x=y==null?void 0:y.quizzes)!=null&&x.length?m(y.quizzes[0]):m(null)}},[i,a,e,s]);const M=o=>{v||S(o)},Q=()=>{if(k==null)return;E(!0);const o=u.questions[h].answers.find(c=>c.id===k);o!=null&&o.correct&&T(c=>c+1),D(!!(o!=null&&o.correct)),H(c=>[...c,{questionId:u.questions[h].id,answerId:k}])},X=()=>{h+1>=u.questions.length?A(!0):(W(o=>o+1),S(null),E(!1))},_=()=>{const o=u.questions.length,c=Math.round(C/o*100),x=t!=null&&t.id?t.id:1;fetch("/api/save_progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x,quizId:u.id,progress:c,answers:L})}).then(p=>{if(!p.ok)throw new Error("Ошибка сети");return fetch("/content/app_data.json")}).then(p=>{if(!p.ok)throw new Error("Ошибка загрузки данных");return p.json()}).then(p=>{f(p),g(!1),r(`/lessons/${e}`)}).catch(p=>{q(!0),setTimeout(()=>{q(!1),r(`/lessons/${e}`)},1e3)})};if(i)return n.jsx("div",{children:"Загрузка..."});if(d)return n.jsxs("div",{className:"lesson-quiz error",children:["Ошибка: ",d]});if(!u)return n.jsx("div",{className:"lesson-quiz",children:"Тест не найден"});if(V){const o=u.questions.length,c=Math.round(C/o*100);return n.jsxs("div",{className:"quiz",children:[B&&n.jsx(F,{text:"Не удалось сохранить прогресс"}),n.jsx("h1",{children:"Результаты теста"}),n.jsx("div",{className:"results-circle",children:n.jsx(et,{value:c,text:`${c}%`,styles:st({pathColor:c>=70?"var(--success)":"var(--danger)",textColor:"var(--white)",trailColor:"#eee",backgroundColor:"var(--white)"})})}),n.jsxs("div",{className:"quiz-footer",children:[n.jsxs("div",{className:"results",children:[n.jsxs("p",{className:"correct",children:["Правильные ответы: ",C]}),n.jsxs("p",{className:"incorrect",children:["Неправильные ответы: ",o-C]})]}),n.jsx("button",{className:"btn",onClick:_,children:"Завершить тест"})]})]})}const z=u.questions[h];return n.jsxs("div",{className:"quiz",children:[n.jsxs("div",{className:"quiz-question",children:[n.jsxs("div",{className:"progress",children:[n.jsxs("p",{children:["Вопрос ",h+1," из ",u.questions.length]}),n.jsx("progress",{value:h+1,max:u.questions.length})]}),n.jsx("h2",{children:z.text}),n.jsx("div",{className:"quiz-answers",children:z.answers.map(o=>{const c=k===o.id,x=v?o.correct?"correct":c?"incorrect":"":"";return n.jsxs("label",{className:`quiz-answer ${x}`,children:[n.jsx("input",{type:"radio",name:"answer",checked:c,onChange:()=>M(o.id),disabled:v}),o.text]},o.id)})})]}),n.jsx("div",{className:"actions",children:v?n.jsx("button",{className:`btn ${P?"btn-correct":"btn-incorrect"}`,onClick:X,children:P?"Правильно, к следующему":"Неправильно, к следующему"}):n.jsx("button",{className:"btn",onClick:Q,disabled:k==null,children:"Проверить"})})]})}export{ot as default};
