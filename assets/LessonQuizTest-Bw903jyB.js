import{r as u,d as F,a as J,b as Y,j as n}from"./index-DF-I8wqH.js";/* empty css                         */import{A as K}from"./Alert-TtmXVApb.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var j=function(t,e){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var a in r)r.hasOwnProperty(a)&&(s[a]=r[a])},j(t,e)};function Z(t,e){j(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}var tt=100,et=100,z=50,R=50,S=50;function V(t){var e=t.className,s=t.counterClockwise,r=t.dashRatio,a=t.pathRadius,c=t.strokeWidth,h=t.style;return u.createElement("path",{className:e,style:Object.assign({},h,rt({pathRadius:a,dashRatio:r,counterClockwise:s})),d:st({pathRadius:a,counterClockwise:s}),strokeWidth:c,fillOpacity:0})}function st(t){var e=t.pathRadius,s=t.counterClockwise,r=e,a=s?1:0;return`
      M `+R+","+S+`
      m 0,-`+r+`
      a `+r+","+r+" "+a+" 1 1 0,"+2*r+`
      a `+r+","+r+" "+a+" 1 1 0,-"+2*r+`
    `}function rt(t){var e=t.counterClockwise,s=t.dashRatio,r=t.pathRadius,a=Math.PI*2*r,c=(1-s)*a;return{strokeDasharray:a+"px "+a+"px",strokeDashoffset:(e?-c:c)+"px"}}var at=function(t){Z(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},e.prototype.getPathRadius=function(){return z-this.props.strokeWidth/2-this.getBackgroundPadding()},e.prototype.getPathRatio=function(){var s=this.props,r=s.value,a=s.minValue,c=s.maxValue,h=Math.min(Math.max(r,a),c);return(h-a)/(c-a)},e.prototype.render=function(){var s=this.props,r=s.circleRatio,a=s.className,c=s.classes,h=s.counterClockwise,f=s.styles,x=s.strokeWidth,i=s.text,m=this.getPathRadius(),p=this.getPathRatio();return u.createElement("svg",{className:c.root+" "+a,style:f.root,viewBox:"0 0 "+tt+" "+et,"data-test-id":"CircularProgressbar"},this.props.background?u.createElement("circle",{className:c.background,style:f.background,cx:R,cy:S,r:z}):null,u.createElement(V,{className:c.trail,counterClockwise:h,dashRatio:r,pathRadius:m,strokeWidth:x,style:f.trail}),u.createElement(V,{className:c.path,counterClockwise:h,dashRatio:p*r,pathRadius:m,strokeWidth:x,style:f.path}),i?u.createElement("text",{className:c.text,style:f.text,x:R,y:S},i):null)},e.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},e}(u.Component);function nt(t){var e=t.rotation,s=t.strokeLinecap,r=t.textColor,a=t.textSize,c=t.pathColor,h=t.pathTransition,f=t.pathTransitionDuration,x=t.trailColor,i=t.backgroundColor,m=e==null?void 0:"rotate("+e+"turn)",p=e==null?void 0:"center center";return{root:{},path:b({stroke:c,strokeLinecap:s,transform:m,transformOrigin:p,transition:h,transitionDuration:f==null?void 0:f+"s"}),trail:b({stroke:x,strokeLinecap:s,transform:m,transformOrigin:p}),text:b({fill:r,fontSize:a}),background:b({fill:i})}}function b(t){return Object.keys(t).forEach(function(e){t[e]==null&&delete t[e]}),t}function lt({user:t}){var W,T,q;const{courseId:e,lessonId:s}=F(),r=J(),{data:a,loading:c,error:h,setData:f,setLoading:x}=Y(),[i,m]=u.useState(null),[p,A]=u.useState(0),[v,E]=u.useState(null),[C,P]=u.useState(!1),[y,D]=u.useState(0),[B,_]=u.useState(!1),[I,L]=u.useState(!1),[H,O]=u.useState(!1),[M,Q]=u.useState([]);u.useEffect(()=>{var o,l,g;if(!c&&a){const d=(o=a.courses)==null?void 0:o.find(N=>String(N.id)===e),w=(l=d==null?void 0:d.lessons)==null?void 0:l.find(N=>String(N.id)===s);(g=w==null?void 0:w.quizzes)!=null&&g.length?m(w.quizzes[0]):m(null)}},[c,a,e,s]);const X=o=>{C||E(o)},$=()=>{if(v==null)return;P(!0);const o=i.questions[p].answers.find(l=>l.id===v);o!=null&&o.correct&&D(l=>l+1),L(!!(o!=null&&o.correct)),Q(l=>[...l,{questionId:i.questions[p].id,answerId:v}])},G=()=>{p+1>=i.questions.length?_(!0):(A(o=>o+1),E(null),P(!1))},U=()=>{const o=i.questions.length,l=Math.round(y/o*100),g=t!=null&&t.id?t.id:0;fetch("/api/save_attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g,quizId:i.id,courseId:e,progress:l,answers:M})}).then(d=>{if(!d.ok)throw new Error("Ошибка сети");return fetch(`/api/get_app_data?user_id=${g}`)}).then(d=>{if(!d.ok)throw new Error("Ошибка загрузки данных");return d.json()}).then(d=>{f(d),x(!1),r(`/lessons/${e}`)}).catch(d=>{O(!0),console.error("Ошибка сохранения попытки:",d),setTimeout(()=>{O(!1),r(`/lessons/${e}`)},2e3)})};if(c)return n.jsx("div",{children:"Загрузка..."});if(h)return n.jsxs("div",{className:"lesson-quiz error",children:["Ошибка: ",h]});if(!i)return n.jsx("div",{className:"lesson-quiz",children:"Тест не найден"});if(B){const o=i.questions.length,l=Math.round(y/o*100);return n.jsxs("div",{className:"quiz",children:[H&&n.jsx(K,{text:"Не удалось сохранить прогресс"}),n.jsx("h1",{children:"Результаты теста"}),n.jsx("div",{className:"results-circle",children:n.jsx(at,{value:l,text:`${l}%`,styles:nt({pathColor:l>=70?"var(--success)":"var(--danger)",textColor:"var(--white)",trailColor:"#eee",backgroundColor:"var(--white)"})})}),n.jsxs("div",{className:"quiz-footer",children:[n.jsxs("div",{className:"results",children:[n.jsxs("p",{className:"correct",children:["Правильные ответы: ",y]}),n.jsxs("p",{className:"incorrect",children:["Неправильные ответы: ",o-y]})]}),n.jsx("button",{className:"btn",onClick:U,children:"Завершить тест"})]})]})}const k=(i==null?void 0:i.questions)&&i.questions[p];return n.jsxs("div",{className:"quiz",children:[n.jsxs("div",{className:"quiz-question",children:[n.jsxs("div",{className:"progress",children:[n.jsxs("p",{children:["Вопрос ",p+1," из ",((W=i==null?void 0:i.questions)==null?void 0:W.length)||0]}),n.jsx("progress",{value:p+1,max:(T=i==null?void 0:i.questions)==null?void 0:T.length})]}),n.jsx("h2",{children:k==null?void 0:k.text}),n.jsx("div",{className:"quiz-answers",children:(q=k==null?void 0:k.answers)==null?void 0:q.map(o=>{const l=v===o.id,g=C?o.correct?"correct":l?"incorrect":"":"";return n.jsxs("label",{className:`quiz-answer ${g}`,children:[n.jsx("input",{type:"radio",name:"answer",checked:l,onChange:()=>X(o.id),disabled:C}),o.text]},o.id)})})]}),n.jsx("div",{className:"actions",children:C?n.jsx("button",{className:`btn ${I?"btn-correct":"btn-incorrect"}`,onClick:G,children:I?"Правильно, к следующему":"Неправильно, к следующему"}):n.jsx("button",{className:"btn",onClick:$,disabled:v==null,children:"Проверить"})})]})}export{lt as default};
