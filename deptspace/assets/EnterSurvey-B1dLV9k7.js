import{a as V,b as $,c as O,r as p,j as t,L as D}from"./index-DF-I8wqH.js";import{B}from"./BackIcon-loaPqsaO.js";/* empty css                         *//* empty css                     */import{A as L}from"./Alert-TtmXVApb.js";import{C as P}from"./ContentNotFound-DVSDmGeN.js";function K({user:m}){var v,j,w,b;const N=V(),{data:s}=$(),{setSurveyPassed:S}=O(),[l,I]=p.useState({}),[u,y]=p.useState({}),[z,h]=p.useState(!1),[E,o]=p.useState(!1),_=(m==null?void 0:m.id)||0,k=(v=s==null?void 0:s.enter_survey)==null?void 0:v.id,x=(e,a)=>{let r=a;(e.type==="phone"||e.type==="age")&&(r=a.replace(/\D/g,"")),I(i=>({...i,[e.id]:r})),y(i=>({...i,[e.id]:!1}))},A=()=>{var r;const e={};let a=null;return(r=s==null?void 0:s.enter_survey)==null||r.questions.forEach(i=>{const d=l[i.id];d?i.type==="age"&&!/^\d{1,3}$/.test(d)&&(e[i.id]="Введите корректный возраст",a||(a=i.id)):(e[i.id]="Это поле обязательно",a||(a=i.id))}),y(e),{isValid:Object.keys(e).length===0,firstInvalidQuestionId:a}},C=e=>{var g;e.preventDefault();const{isValid:a,firstInvalidQuestionId:r}=A();if(!a){const n=`[name="q-${r}"]`,c=document.querySelector(n);c&&(c.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>c.focus(),300));return}h(!0);const i=[],d=[];(g=s==null?void 0:s.enter_survey)==null||g.questions.forEach(n=>{const c=l[n.id];if(n.type==="quiz"){const f=n.answers.find(T=>T.id===c);f&&(i.push({questionId:n.id,answerId:f.id,text:""}),d.push({question:n.text,answer:f.text}))}else(n.type==="phone"||n.type==="text"||n.type==="age")&&c&&(i.push({questionId:n.id,answerId:0,text:c}),d.push({question:n.text,answer:c}))}),fetch("/api/submit_enter_survey",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:_,surveyId:k,formattedAnswers:i,verboseAnswers:d})}).then(n=>{n.ok?(S(!0),N("/")):(o(!0),setTimeout(()=>o(!1),1e3),h(!1))}).catch(()=>{o(!0),setTimeout(()=>o(!1),1e3),h(!1)})};return t.jsxs("div",{className:"survey content quiz-results-content",children:[E&&t.jsx(L,{text:"Произошла ошибка, попробуйте еще раз"}),t.jsxs(D,{to:"/",className:"back-link",children:[t.jsx(B,{}),"Назад"]}),t.jsxs("form",{className:"quiz",onSubmit:C,noValidate:!0,children:[t.jsxs("div",{className:"quiz-wrapper",children:[t.jsx("h1",{children:"Входное тестирование"}),((j=s==null?void 0:s.enter_survey)==null?void 0:j.description)&&t.jsx("p",{className:"survey-description",children:s.enter_survey.description}),(b=(w=s==null?void 0:s.enter_survey)==null?void 0:w.questions)!=null&&b.length?s.enter_survey.questions.map(e=>{var a;return t.jsxs("div",{className:`quiz-question ${u[e.id]?"error":""}`,children:[t.jsxs("h2",{children:[e.id,". ",e.text]}),u[e.id]&&t.jsx("div",{className:"error-text",children:u[e.id]}),t.jsx("div",{className:"quiz-answers",children:e.type==="quiz"&&((a=e.answers)==null?void 0:a.map(r=>t.jsxs("label",{className:"quiz-answer",children:[t.jsx("input",{type:"radio",name:`q-${e.id}`,value:r.id,checked:l[e.id]===r.id,onChange:()=>x(e,r.id)}),r.text]},r.id)))}),(e.type==="phone"||e.type==="text"||e.type==="age")&&t.jsx("input",{className:"quiz-input",type:"text",name:`q-${e.id}`,placeholder:e.type==="phone"?"Введите номер телефона":"Введите ваш ответ",value:l[e.id]||"",onChange:r=>x(e,r.target.value)})]},e.id)}):t.jsx(P,{message:"Вопросы не найдены"})]}),t.jsx("button",{className:"btn",type:"submit",disabled:z,children:"Отправить"})]})]})}export{K as default};
